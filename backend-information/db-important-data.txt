מידע חשוב נוסף על מבנה הדאטאבייס
1. שדות Built-in אוטומטיים (בכל טבלה)
כל רשומה מקבלת אוטומטית:

id (string) - מזהה ייחודי
created_date (datetime) - תאריך יצירה
updated_date (datetime) - תאריך עדכון אחרון
created_by (string) - אימייל המשתמש שיצר
2. שדות Auto-Increment (מספור אוטומטי)
השדות הבאים עולים אוטומטית:

Client.client_number - מספר לקוח (ייחודי)
Patient.patient_number - מספר מטופל (ייחודי)
Order.order_number - מספר הזמנה
MedicalVisit.visit_number - מספר ביקור
LabTest.test_number - מספר בדיקה
Appointment.appointment_number - מספר תור
3. שדות Unique (ייחודיים)
Client.client_number - חייב להיות ייחודי
Client.id_number - חייב להיות ייחודי
Patient.patient_number - חייב להיות ייחודי
4. דפוס Denormalization (כפילות מכוונת)
המערכת שומרת גם ID וגם שם במקומות רבים למניעת Joins:

patient_id + patient_name
client_id + client_name  
doctor_id + doctor_name
room_id + room_name
סיבה: ביצועים + היסטוריה (אם שם משתנה, הרשומות הישנות שומרות את השם המקורי)

5. דפוס Status Fields (שדות סטטוס)
Appointment.status:

scheduled → confirmed → arrived → in_progress → completed
או: no_show / cancelled
MedicalVisit.status:

draft → completed
Order.status:

draft → pending → processing → shipped → delivered
או: cancelled / completed_with_shortages
TimeClockEntry.status:

clocked_in → clocked_out
VacationRequest.status:

pending → approved / rejected
WeeklySchedule.approval_status:

draft → pending_approval → approved / rejected
LabTest.status:

pending → completed → reviewed
Billing.status:

draft → pending → paid / partial / cancelled
InventoryShortage.status:

needed → ordered → stocked
ClinicCase.status:

pending → approved → submitted
Patient.status:

active / inactive
VetReferral.status:

open / closed
6. דפוס Soft Delete (is_active במקום מחיקה)
במקום למחוק רשומות, משתמשים ב:

is_active (boolean) - בטבלאות: User, ExternalEmployee, Patient, ShiftTemplate, AppointmentType, SlotTemplate, VaccinationType, LabTestType, FormConfiguration, MessageTemplate, PriceList, PublicProfile, DoctorSchedule, CalendarSettings
סיבה: שמירת היסטוריה ומניעת קריסת יחסים

7. דפוס Audit Trail (מעקב אחר שינויים)
שדות מעקב:

submitted_by + submitted_date - מי שלח לאישור
approved_by + approval_date - מי אישר
rejected_by + rejection_reason - מי דחה ולמה
created_by_name - שם מי שיצר
filled_by_name - שם מי שמילא
released_by + released_date - מי שחרר
executed_by + executed_by_name - מי ביצע
measured_by - מי מדד
performed_by - מי ביצע
administered_by - מי הזריק
uploaded_by - מי העלה
received_by + received_date - מי קיבל
last_counted_by + last_counted_date - מי ספר אחרון
8. דפוס Arrays for Nested Data
שדות מערך לנתונים מורכבים:

HospitalizedAnimal.treatment_instructions[] - הוראות טיפול
HospitalizedAnimal.monitoring_log[] - יומן ניטור
HospitalizedAnimal.fluids_log[] - יומן נוזלים
HospitalizedAnimal.treatments_log[] - יומן טיפולים
HospitalizedAnimal.observations_log[] - יומן תצפיות
MedicalVisit.lab_tests[] - בדיקות מעבדה
MedicalVisit.prescriptions[] - מרשמים
MedicalVisit.items_from_pricelist[] - פריטים
Billing.items[] - פריטי חיוב
Billing.payments[] - תשלומים
ClinicCase.treatments[] - טיפולים
VetReferral.messages[] - הודעות
Appointment.participants[] - משתתפים
Order.items[] - פריטי הזמנה
SlotTemplate.break_times[] - הפסקות
ProtocolTemplate.fields[] - שדות טופס
9. דפוס Objects for Complex Data
שדות אובייקט לנתונים מובנים:

WeeklySchedule.schedule_data - מבנה השבוע
WeeklySchedule.locked_shifts - משמרות נעולות
WeeklySchedule.reception_coverage - כיסוי קבלה
Order.received_items - פריטים שהתקבלו
FilledProtocol.data - נתוני הפרוטוקול
FilledProtocol.field_metadata - מטא-דאטה
SupplierPrice.supplier_prices - מחירי ספקים
MedicalVisit.vital_signs - סימנים חיוניים
LabTest.results - תוצאות בדיקה
InventoryItem.locations[] - מיקומים וכמויות
ShiftTemplate.staffing_requirements - דרישות איוש
FormConfiguration.notification_settings - הגדרות התראות
10. User Entity - הגבלות מיוחדות
טבלת User היא built-in עם חוקי אבטחה אוטומטיים:

רק Admin יכול: לראות רשימת משתמשים, לערוך משתמשים אחרים, למחוק משתמשים
משתמש רגיל יכול: לראות ולערוך רק את עצמו
לא ניתן להוסיף משתמשים ישירות - רק דרך הזמנה (invite)
אסור לשנות את השדות: id, email, full_name, role (רק admin)
11. Enum Values החשובים ביותר
job (תפקידים):

doctor, assistant, receptionist, admin
vacation_type:

regular, sick_leave, unpaid_leave
shift_type:

morning, evening, full_day, split
species (סוגי חיות):

כלב, חתול, ארנב, תוכי, חמוס, שרקן, אחר
sex:

זכר, נקבה
insurance_company:

מרפאט, חיותא, פניקס, אחר
room_type:

examination, surgery, laboratory, imaging, reception
category (קטגוריות מוצרים):

בדיקות, ניתוחים, תרופות, מזון, תכשירים, ציוד, צעצועים, אחר
channel (ערוצי תקשורת):

whatsapp, sms, email
preferred_contact:

phone, email, whatsapp, sms
12. Missing Foreign Key Constraints
⚠️ חשוב לדעת: המערכת לא אוכפת foreign key constraints!

אם תמחק Client, ה-Patients שלו יישארו עם client_id לא תקף
אם תמחק User, ה-Constraints שלו יישארו עם employee_id לא תקף
אחריות המפתח: לבדוק קיום לפני מחיקה או להשתמש ב-soft delete
13. דפוס Follow-up (מעקבים)
מספר טבלאות מנהלות מעקבים עתידיים:

MedicalVisit: follow_up_date + follow_up_completed
Vaccination: next_vaccination_date + first_reminder_date + second_reminder_date
VaccinationType: first_reminder_days_before + second_reminder_days_before
14. דפוס Pricing (תמחור)
מספר מקומות לשמירת מחירים:

AppointmentType.base_price - מחיר בסיס לסוג תור
ClientPriceList - מחירון כללי ללקוחות
PriceList + PriceListItem - מחירונים מותאמים אישית
SupplierPrice - מחירי ספקים
שדות supplier_price ו-client_price בטבלאות שונות
15. דפוס Metadata (מטא-דאטה)
שמירת מידע על מבנה הטופס עצמו:

ProtocolTemplate.fields[] - מבנה הטופס
FormConfiguration.fields[] - הגדרות שדות
LabTestType.parameters[] - פרמטרים וטווחים תקינים
FilledProtocol.field_metadata - מי מילא כל שדה ומתי
16. תבניות vs. מופעים (Templates vs. Instances)
SlotTemplate → יוצר → Slot (תבנית → משבצת בפועל)
ProtocolTemplate → יוצר → FilledProtocol (תבנית → פרוטוקול ממולא)
VaccinationType → מוזכר ב → Vaccination (סוג → מופע)
LabTestType → מוזכר ב → LabTest (סוג → בדיקה)
AppointmentType → מוזכר ב → Appointment (סוג → תור)
ShiftTemplate → לא יוצר מופעים - רק הגדרה
17. דפוס Recurrence (חזרתיות)
CalendarSettings.recurrence_type - none/weekly/monthly/yearly
CalendarSettings.recurrence_end_date - עד מתי לחזור
18. דפוס Blocking (חסימות)
WeeklySchedule.locked_shifts - משמרות נעולות לעריכה
CalendarSettings.is_blocked + block_reason - ימים חסומים
19. מספור אוטומטי - התנהגות
המספרים האוטומטיים (client_number, patient_number וכו') מתנהגים כך:

לא ניתנים מחדש אחרי מחיקה
עולים תמיד - אפילו אם יש חורים ברצף
כרונולוגיים - משקפים סדר יצירה
20. אין Cascade Delete
אם תמחק רשומה, הרשומות המקושרות לא נמחקות אוטומטית:

צריך למחוק ידנית את כל הרשומות התלויות
או להשתמש ב-soft delete (is_active = false)
סיכום: המערכת מעדיפה denormalization לביצועים, soft deletes לשמירת היסטוריה, וaudit trails מלאים על פני normalization מוחלטת.